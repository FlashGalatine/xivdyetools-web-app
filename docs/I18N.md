# XIV Dye Tools ‚Äì Internationalization (i18n) Guide

This guide explains how to use the i18n system in XIV Dye Tools to ensure all user-facing text is properly internationalized.

## Overview

XIV Dye Tools supports 6 languages:
- **en** ‚Äì English (default)
- **ja** ‚Äì Japanese (Êó•Êú¨Ë™û)
- **de** ‚Äì German (Deutsch)
- **fr** ‚Äì French (Fran√ßais)
- **ko** ‚Äì Korean (ÌïúÍµ≠Ïñ¥)
- **zh** ‚Äì Chinese Simplified (ÁÆÄ‰Ωì‰∏≠Êñá)

The i18n system has two layers:

| Layer | Service | Use For |
|-------|---------|---------|
| Core Library | `LocalizationService` | FFXIV game data (dye names, categories, races, etc.) |
| Web App | `LanguageService` | UI strings (buttons, labels, messages, etc.) |

## Quick Reference

```typescript
import { LanguageService } from '@services/index';

// Simple translation
const label = LanguageService.t('common.save');

// Translation with parameters
const message = LanguageService.tInterpolate('collections.dyeCount', { count: '5' });

// Game data (dye names, categories)
const dyeName = LanguageService.getDyeName(itemID);
const category = LanguageService.getCategory('Reds');
```

---

## Using LanguageService

### Basic Translation: `t(key)`

Use `LanguageService.t()` for simple string translations:

```typescript
// ‚úÖ Good
button.textContent = LanguageService.t('common.save');
ToastService.success(LanguageService.t('success.copiedToClipboard'));

// ‚ùå Bad - hardcoded string
button.textContent = 'Save';
ToastService.success('Copied to clipboard!');
```

### Interpolated Translation: `tInterpolate(key, params)`

Use `LanguageService.tInterpolate()` when the translation contains placeholders:

```typescript
// In en.json: "dyeCount": "{count} dye(s)"
const text = LanguageService.tInterpolate('collections.dyeCount', { count: '5' });
// Result: "5 dye(s)"

// In en.json: "addedToCollection": "Added to {name}"
const msg = LanguageService.tInterpolate('collections.addedToCollection', {
  name: collection.name
});
// Result: "Added to My Favorites"
```

**Note:** Parameter values must be strings. Convert numbers with `String(value)` or `.toString()`.

### Game Data Translations

For FFXIV-specific terminology, use the proxy methods that wrap the core library:

```typescript
// Dye names (uses itemID from dye data)
const name = LanguageService.getDyeName(dye.itemID);

// Categories
const category = LanguageService.getCategory('Reds');

// Acquisition methods
const source = LanguageService.getAcquisition('Crafted');

// Harmony types
const harmony = LanguageService.getHarmonyType('complementary');

// Vision types (colorblindness)
const vision = LanguageService.getVisionType('deuteranopia');

// Races and clans
const race = LanguageService.getRace('Miqote');
const clan = LanguageService.getClan('SeekerOfTheSun');
```

---

## Translation Keys

### Namespace Structure

Translation keys use dot notation organized by namespace:

| Namespace | Use For | Example |
|-----------|---------|---------|
| `common` | Shared UI elements | `common.save`, `common.cancel`, `common.close` |
| `config` | Settings and options | `config.colorFormats`, `config.showPrices` |
| `errors` | Error messages | `errors.failedToLoad`, `errors.copyFailed` |
| `success` | Success messages | `success.copiedToClipboard`, `success.saved` |
| `tools.*` | Tool titles/descriptions | `tools.harmony.title`, `tools.mixer.shortName` |
| `harmony` | Harmony tool UI | `harmony.addToComparison`, `harmony.copiedHex` |
| `matcher` | Extractor tool UI | `matcher.uploadImage`, `matcher.paletteExtracted` |
| `mixer` | Mixer tool UI | `mixer.startDye`, `mixer.endDye` |
| `comparison` | Comparison tool UI | `comparison.selectDyes`, `comparison.statistics` |
| `gradient` | Gradient tool UI | `gradient.selectColor`, `gradient.noMatchesFound` |
| `accessibility` | Vision tool UI | `accessibility.visionTypes`, `accessibility.showLabels` |
| `preset` | Preset feature UI | `preset.submittedSuccess`, `preset.loginToVote` |
| `collections` | Collections feature | `collections.addedToCollection`, `collections.favoritesFull` |
| `colorPalette` | Color palette drawer | `colorPalette.searchPlaceholder`, `colorPalette.noDyesFound` |
| `aria` | Accessibility labels | `aria.closeSidebar`, `aria.selectRandomDye` |

### Naming Conventions

```typescript
// ‚úÖ Good - descriptive, follows namespace
LanguageService.t('preset.submittedPendingReview')
LanguageService.t('errors.failedToLoadSubmissions')
LanguageService.t('harmony.addedToComparison')

// ‚ùå Bad - wrong namespace
LanguageService.t('common.copiedToClipboard')  // Should be success.*
LanguageService.t('toast.addedToMixer')         // toast.* doesn't exist

// ‚ùå Bad - too generic
LanguageService.t('message')
LanguageService.t('text1')
```

---

## Adding New Translation Keys

### Step 1: Add to en.json

Add the key to `src/locales/en.json` in the appropriate namespace:

```json
{
  "preset": {
    "existingKey": "Existing value",
    "newKey": "Your new translation"
  }
}
```

For interpolated strings, use `{placeholder}` syntax:

```json
{
  "collections": {
    "itemCount": "{count} item(s) in collection"
  }
}
```

### Step 2: Add to Other Locale Files

Add the same key to all other locale files:
- `src/locales/ja.json`
- `src/locales/de.json`
- `src/locales/fr.json`
- `src/locales/ko.json`
- `src/locales/zh.json`

**Tip:** If you don't have translations yet, copy the English value as a placeholder. It's better than having a missing key.

### Step 3: Validate

Run the validation script to ensure the key exists:

```bash
npm run validate:i18n
```

---

## Common Patterns

### Toast Messages

```typescript
// Success
ToastService.success(LanguageService.t('success.copiedToClipboard'));

// Error with API fallback
ToastService.error(result.error || LanguageService.t('errors.submitFailed'));

// Info with interpolation
ToastService.info(
  LanguageService.tInterpolate('preset.duplicateFound', { name: existingName })
);
```

### Modal Titles and Content

```typescript
ModalService.show({
  type: 'confirm',
  title: LanguageService.t('preset.confirmDelete'),
  message: LanguageService.t('preset.deleteWarning'),
  confirmText: LanguageService.t('common.delete'),
  cancelText: LanguageService.t('common.cancel'),
});
```

### Accessibility Labels

```typescript
button.setAttribute('aria-label', LanguageService.t('aria.closeSidebar'));
input.setAttribute('placeholder', LanguageService.t('colorPalette.searchPlaceholder'));
```

### Conditional Messages

```typescript
// Using different keys based on state
const messageKey = isLoggedIn ? 'preset.submittedSuccess' : 'preset.loginToSubmit';
ToastService.info(LanguageService.t(messageKey));

// Pluralization pattern
const key = count === 1 ? 'preset.voteCount' : 'preset.votesCount';
const text = LanguageService.tInterpolate(key, { count: String(count) });
```

---

## Anti-Patterns to Avoid

### ‚ùå Hardcoded Strings

```typescript
// Bad
ToastService.success('Preset saved successfully!');
button.textContent = 'Submit';

// Good
ToastService.success(LanguageService.t('preset.savedSuccess'));
button.textContent = LanguageService.t('common.submit');
```

### ‚ùå String Concatenation

```typescript
// Bad - breaks translation
const msg = 'Added ' + dye.name + ' to comparison';

// Good - use interpolation
const msg = LanguageService.tInterpolate('harmony.addedDyeToTool', {
  name: dye.name
});
```

### ‚ùå Fallback Patterns

```typescript
// Bad - indicates missing key
LanguageService.t('some.key') || 'Fallback text'

// Good - add the key to en.json instead
LanguageService.t('some.key')
```

### ‚ùå Wrong Namespace

```typescript
// Bad - common.* is for shared UI elements, not success messages
LanguageService.t('common.copiedToClipboard')

// Good - use the success.* namespace
LanguageService.t('success.copiedToClipboard')
```

### ‚ùå Dynamic Key Construction

```typescript
// Bad - hard to track and validate
const key = `tools.${toolName}.title`;
LanguageService.t(key);

// Acceptable if necessary - document the possible values
const toolKeys: Record<ToolName, string> = {
  harmony: 'tools.harmony.title',
  mixer: 'tools.mixer.title',
  // ...
};
LanguageService.t(toolKeys[toolName]);
```

---

## Validation

### Running the Validator

The project includes a build-time validation script:

```bash
# Basic validation
npm run validate:i18n

# With typo suggestions
npm run validate:i18n -- --fix
```

### What It Checks

- All `LanguageService.t('key')` calls reference existing keys
- All `LanguageService.tInterpolate('key', ...)` calls reference existing keys
- Reports file:line for any missing keys

### Example Output

```
üåê i18n Translation Key Validator

üìö Loaded 988 translation keys from en.json
üìÅ Scanning 137 source files...

‚úÖ All 967 translation key references are valid!

üìä Summary:
   ‚Ä¢ Total keys in en.json: 988
   ‚Ä¢ Keys referenced in code: 676
   ‚Ä¢ Total references checked: 967
```

---

## Reference

### LanguageService API

| Method | Description |
|--------|-------------|
| `t(key)` | Get translation for a key |
| `tInterpolate(key, params)` | Get translation with placeholder substitution |
| `getDyeName(itemID)` | Get localized dye name from core library |
| `getCategory(category)` | Get localized category name |
| `getAcquisition(method)` | Get localized acquisition method |
| `getHarmonyType(type)` | Get localized harmony type name |
| `getVisionType(type)` | Get localized vision type name |
| `getRace(race)` | Get localized race name |
| `getClan(clan)` | Get localized clan/subrace name |
| `getCurrentLocale()` | Get current locale code |
| `subscribe(listener)` | Subscribe to locale changes |

### Locale Files

| File | Language |
|------|----------|
| `src/locales/en.json` | English (primary) |
| `src/locales/ja.json` | Japanese |
| `src/locales/de.json` | German |
| `src/locales/fr.json` | French |
| `src/locales/ko.json` | Korean |
| `src/locales/zh.json` | Chinese Simplified |

### Related Documentation

- `docs/STYLE_GUIDE.md` ‚Äì Overall front-end patterns
- `xivdyetools-docs/audits/2026-01-17/` ‚Äì i18n audit findings and remediation
